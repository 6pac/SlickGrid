<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <link rel="shortcut icon" type="image/ico" href="favicon.ico" />
  <link rel="stylesheet" href="../slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="../css/smoothness/jquery-ui-1.11.3.custom.css" type="text/css"/>
  <link rel="stylesheet" href="examples.css" type="text/css"/>
  <link rel="stylesheet" href="../plugins/slick.rowdetailview.css" type="text/css"/>
  <style>
    .detail {
        padding: 5px
    }
    .preload {
      font-size: 18px;
    }
  </style>
</head>
<body>
<div style="position:relative">
  <div style="width:600px;">
    <div id="myGrid" style="width:100%;height:600px;"></div>
  </div>
  <br/>

  <div class="options-panel">
    <h2>Demonstrates:</h2>
    <ul>
      <li>DetailView Plugin</li>
	  <li>Using onetime loading</li>
	  <li>Example of using different views per row e.g. check any row multiple of 2 and it is different from odd rows<li>
    </ul>
      <h2>View Source:</h2>
      <ul>
          <li><A href="https://github.com/6pac/SlickGrid/blob/master/examples/example16-row-detail.html" target="_sourcewindow"> View the source for this example on Github</a></li>
      </ul>

  </div>
</div>

<script src="../lib/firebugx.js"></script>

<script src="../lib/jquery-1.11.2.min.js"></script>
<script src="../lib/jquery-ui-1.11.3.min.js"></script>
<script src="../lib/jquery.event.drag-2.3.0.js"></script>

<script src="../slick.core.js"></script>
<script src="../plugins/slick.rowdetailview.js"></script>
<script src="../slick.formatters.js"></script>
<script src="../plugins/slick.rowselectionmodel.js"></script>
<script src="../slick.grid.js"></script>
<script src="../slick.dataview.js"></script>

<script>
    var dataView;
    var grid;
    var data = [];
    var fakeNames = ['John Doe', 'Jane Doe', 'Chuck Norris', 'Bumblebee', 'Jackie Chan', 'Elvis Presley', 'Bob Marley', 'Mohammed Ali', 'Bruce Lee', 'Rocky Balboa'];

    var columns = [      
      {id: "sel", name: "#", field: "num", behavior: "select", cssClass: "cell-selection", width: 40, resizable: false, selectable: false },
      {id: "title", name: "Title", field: "title", width: 110, minWidth: 110, cssClass: "cell-title"},
      {id: "duration", name: "Duration", field: "duration"},
      {id: "%", name: "% Complete", field: "percentComplete", width: 80, resizable: false, formatter: Slick.Formatters.PercentCompleteBar},
      {id: "start", name: "Start", field: "start", minWidth: 60},
      {id: "finish", name: "Finish", field: "finish", minWidth: 60},
      {id: "effort-driven", name: "Effort Driven", width: 80, minWidth: 20, maxWidth: 80, cssClass: "cell-effort-driven", field: "effortDriven", formatter: Slick.Formatters.Checkmark}
    ];
    var options = {
      editable: false,
      enableAddRow: false,
      enableCellNavigation: true
    };
    var detailView;

    function DataItem(i) {
      this.num = i;
      this.id = "id_" + i;
      this.percentComplete = Math.round(Math.random() * 100);
      this.effortDriven = (i % 5 == 0);
      this.start = "01/01/2009";
      this.finish = "01/05/2009";
      this.title = "Task " + i;
      this.duration = "5 days";
    }

    function loadingTemplate() {
      return '<div class="preload">Loading...</div>';
    }

	function createView(itemDetail) {
		
		if(itemDetail.num % 2 == 0)
		{
			return "<div><span>Some other view</span></div> "
		}
		
      return returnView = [
        '<div>',
		'<h4>Direct view inserting without template<h4>',
        '<h4>' + itemDetail.title + '</h4>',
        '<div class="detail"><label>Assignee:</label> <span>' + itemDetail.assignee + '</span></div>',
        '<div class="detail"><label>Reporter:</label> <span>' + itemDetail.reporter + '</span></div>',
        '<div class="detail"><label>Duration:</label> <span>' + itemDetail.duration + '</span></div>',
        '<div class="detail"><label>% Complete:</label> <span>' + itemDetail.percentComplete + '</span></div>',
        '<div class="detail"><label>Start:</label> <span>' + itemDetail.start + '</span></div>',
        '<div class="detail"><label>Finish:</label> <span>' + itemDetail.finish + '</span></div>',
        '<div class="detail"><label>Effort Driven:</label> <span>' + itemDetail.effortDriven + '</span></div>',
        '<div class="detail"><label>Effort Driven:</label> <span>' + itemDetail.effortDriven + '</span></div>',
        '</div>'
      ].join('');
    }
	
    function simulateServerCall(item) {
      // fill the template on delay
      setTimeout(function() {
       
        // notify the onAsyncResponse with the "args.itemDetail" (required property)
        // in this case we are passing the view explicitly that we wish to show "args.detailView"
        detailView.onAsyncResponse.notify({
          "itemDetail": item,
		  // The view to display as the detail view
		  "detailView": createView(item)
        }, undefined, this);
      }, 1000);      
    }

    $(function () {
      // prepare the data
      for (var i = 0; i < 5000; i++) {
        data[i] = new DataItem(i);
      }
      dataView = new Slick.Data.DataView({ inlineFilters: true });

      // create the row detail plugin
      detailView = new Slick.RowDetailView({
        cssClass: "detailView-toggle",
        preTemplate: loadingTemplate,
        process: simulateServerCall,
		
		// Load the data once and then reuse it.
		loadOnce: true,
		
        // how many grid rows do we want to use for the detail panel
        // also note that the detail view adds an extra 1 row for padding purposes (so if you choose 4 panelRows, the display will in fact use 5 rows)
        panelRows: 4 
      });

      // push the plugin as first column
      columns.unshift(detailView.getColumnDefinition());

      grid = new Slick.Grid("#myGrid", dataView, columns, options);
      
      // register the column
      grid.setSelectionModel(new Slick.RowSelectionModel({selectActiveRow: false}));
      grid.registerPlugin(detailView);
      
      // initialize the model after all the events have been hooked up
      dataView.beginUpdate();
      dataView.setItems(data);
      dataView.endUpdate();
    })
  </script>
</body>
</html>
