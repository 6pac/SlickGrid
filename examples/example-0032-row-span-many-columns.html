<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
  <link rel="shortcut icon" type="image/ico" href="favicon.ico" />
	<title>SlickGrid Example: colspan & rowspan spanning many columns</title>
  <link rel="stylesheet" href="../dist/styles/css/example-demo.css" type="text/css"/>
  <link rel="stylesheet" href="../dist/styles/css/slick-alpine-theme.css" type="text/css"/>
	<style>
		.slick-row.even .slick-cell.cell-very-high {
        background: #F0FFE0;
    }
    .slick-row.odd .slick-cell.cell-var-span {
        background: #87ceeb;
    }
    .slick-row .slick-cell.rowspan {
      background-color: #95b7a2;
    }
    .slick-row[data-row="0"] .slick-cell.rowspan,
    .slick-row[data-row="8"] .slick-cell.rowspan {
      background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAQ0lEQVQYV2N8/fr1fwY84M6dOwyM+BSBFKioqOBWBFMAsgSrScgKsCpCV4ChCJsCFEW4FMAV4VMAVnT8+PH/IG/iAwDA1DlezHn8bwAAAABJRU5ErkJggg==);
    }
    .slick-row[data-row="8"] .slick-cell.rowspan:nth-child(4) {
      background: #F0FFE0;
    }
    .cellValue {
        float: right;
    }
    .valueComment {
        color: #AAA;
    }
	</style>
</head>

<body>
  <h2 class="title">Example colspan & rowspan spanning many columns</h2>
  <div style="position:relative">
    <div style="width:650px;">
      <div class="grid-header" style="width:100%">
        <label>SlickGrid</label>
      </div>
      <div id="myGrid" class="slick-container" style="width:100%;height:500px;"></div>
    </div>

    <div class="options-panel">
      <h2>
        <a href="/examples/index.html" style="text-decoration: none; font-size: 22px">&#x2302;</a>
        Demonstrates:
      </h2>
      <p>
        This page demonstrates colspan & rowspan using DataView with item metadata.
      </p>
      <p>
        <b>NOTE</b>: "rowspan" is opt-in and requires the <code>enableCellRowSpan</code> grid option enabled to work properly.
      </p>
      <ul>
        <li>basic grid with minimal configuration</li>
        <li>Cells with rowspan > 1</li>

        <li><button id='scrollTo'>Scroll To Row</button><input id="nRow" type="text" value="100" style="width: 50px;" /></li>
        <li><button id='toggleSpans'>Toggle blue cell colspan &amp; rowspan</button></li>
      </ul>
			<h2>View Source:</h2>
      <ul>
          <li><A href="https://github.com/6pac/SlickGrid/blob/master/examples/example-0032-row-span-many-columns.html" target="_sourcewindow"> View the source for this example on Github</a></li>
      </ul>
	</table>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs/Sortable.min.js"></script>
  <script src="sortable-cdn-fallback.js"></script>
	<script src="../dist/browser/slick.core.js"></script>
  <script src="../dist/browser/slick.interactions.js"></script>
  <script src="../dist/browser/slick.grid.js"></script>
  <script src="../dist/browser/slick.dataview.js"></script>
  <script type="text/javascript">
    function rowCellValueFormatter(row, cell, value, columnDef, rowDataItem, cellMetaInfo) {
      return '<div class="cellValue">' + value.toFixed(2) + '</div><div class="valueComment">' + row + '.' + cell + '</div>';
    }

		var grid;
		var columns = [
      { id: "title", name: "Title", field: "title", width: 70 },
      { id: "revenueGrowth", name: "Revenue Growth", field: "revenueGrowth", formatter: rowCellValueFormatter, width: 120 },
      { id: "pricingPolicy", name: "Pricing Policy", sortable: true, field: "pricingPolicy", width: 110, formatter: rowCellValueFormatter },
      { id: "policyIndex", name: "Policy Index", field: "policyIndex", width: 100, formatter: rowCellValueFormatter },
      { id: "expenseControl", name: "Expense Control", field: "expenseControl", width: 110, formatter: rowCellValueFormatter },
      { id: "excessCash", name: "Excess Cash", field: "excessCash", width: 100, formatter: rowCellValueFormatter },
      { id: "netTradeCycle", name: "Net Trade Cycle", field: "netTradeCycle", width: 110, formatter: rowCellValueFormatter },
      { id: "costCapital", name: "Cost of Capital", field: "costCapital", width: 100, formatter: rowCellValueFormatter },
    ];

		var options = {
			//enableAddRow: true,
			enableCellNavigation: true,
			enableColumnReorder: true,
      enableCellRowSpan: true,
		};


    document.addEventListener("DOMContentLoaded", () => {
			var data = [];
			var metadata = {
        0: {
          columns: {
            1: { rowspan: 3 }
          }
        },
        2: {
          columns: {
            0: { rowspan: 3 },
            3: { colspan: 2 }
          }
        },
        3: {
          columns: {
            1: { rowspan: 3, colspan: 2, cssClass: "cell-var-span" },
            3: { rowspan: 3, colspan: 2 }
          }
        },
        8: {
          columns: {
            1: { rowspan: 80 },
            3: { rowspan: 1999, colspan: 2, cssClass: "cell-very-high" }
          }
        },
      };

			for (var i = 0; i < 500; i++) {
				data[i] = {
          id: i,
					title: "Task " + i,
          revenueGrowth: Math.random() * Math.pow(10, Math.random() * 3),
          pricingPolicy: Math.random() * Math.pow(10, Math.random() * 3),
          policyIndex: Math.random() * Math.pow(10, Math.random() * 3),
          expenseControl: Math.random() * Math.pow(10, Math.random() * 3),
          excessCash: Math.random() * Math.pow(10, Math.random() * 3),
          netTradeCycle: Math.random() * Math.pow(10, Math.random() * 3),
          costCapital: Math.random() * Math.pow(10, Math.random() * 3),
				};
			}

      const dataView = new Slick.Data.DataView();
      dataView.getItemMetadata = (row) => {
        return metadata[row] && metadata.attributes
          ? metadata[row]
          : (metadata[row] = Slick.Utils.extend({attributes: {'data-row': row}}, metadata[row]));
      };

			grid = new Slick.Grid("#myGrid", dataView, columns, options);

      dataView.onRowCountChanged.subscribe( (e, args) => {
        grid.updateRowCount();
        grid.render();
      });

      dataView.onRowsChanged.subscribe((e, args) => {
        grid.invalidateRows(args.rows);
        grid.render();
      });

      grid.init();

      dataView.beginUpdate();
      dataView.setItems(data);
      dataView.endUpdate();

      document.querySelector('#toggleSpans').addEventListener('click', (e) => {
        const cell = metadata[3].columns[1];
        if (cell.colspan === 1) {
          cell.rowspan = 3;
          cell.colspan = 2;
        } else {
          cell.rowspan = 5;
          cell.colspan = 1;
        }

        // row index 3 can have a rowspan of up to 5 rows, so we need to invalidate from row 3 + 5 (-1 because of zero index)
        // so: 3 + 5 - 1 => row indexes 3 to 7
        grid.invalidateRows([3, 4, 5, 6, 7]);
        grid.render();
      });

      document.querySelector('#scrollTo').addEventListener('click', (e) => {
        grid.scrollRowToTop(document.querySelector('#nRow').value);
      });

      document.querySelector('#nRow').addEventListener('keydown', (e) => {
        if (e.keyCode == 13) {
          document.querySelector('#scrollTo').click();
        }
      });
		});
	</script>
</body>
</html>