/**
 * SlickGrid v4.0.1
 * (c) 2009-present Michael Leibman
 * homepage: http://github.com/mleibman/slickgrid
 * license: MIT
 * date: 2023-06-30
 * file: ./plugins/slick.rowdetailview.js
 */
!function(e){Slick.Utils.extend(!0,e,{Slick:{Plugins:{RowDetailView:function(e){var d,r,c,u,p="id",n=null,o=this,t=null,l=[],i=new Slick.EventHandler,s=5,w=0,a={columnId:"_detail_selector",cssClass:"detailView-toggle",expandedClass:null,collapsedClass:null,keyPrefix:"_",loadOnce:!1,collapseAllOnSort:!0,saveDetailViewOnScroll:!0,singleRowExpand:!1,useSimpleViewportCalc:!1,alwaysRenderColumn:!0,toolTip:"",width:30,maxRows:null},g=a.keyPrefix,f=0,m=[],R=Slick.Utils.extend(!0,{},a,e);"function"==typeof R.expandableOverride&&E(R.expandableOverride);function h(e,t){if(e)for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1}function v(e,t){var i,n=d.getDataItem(t.row);z(t.row,n,d)&&(R.useRowClick||d.getColumns()[t.cell].id===R.columnId&&e.target.classList.contains(R.cssClass||""))&&(d.getEditorLock().isActive()&&!d.getEditorLock().commitCurrentEdit()?e.preventDefault():(o.onBeforeRowDetailToggle.notify({grid:d,item:n},e,o),z(t=t.row,i=n,d)&&(u.beginUpdate(),(t=i)&&(t[g+"collapsed"]?I:V)(t),u.endUpdate()),o.onAfterRowDetailToggle.notify({grid:d,item:n,expandedRows:l},e,o),e.stopPropagation()),e.stopImmediatePropagation())}function b(){var i;if(R.useSimpleViewportCalc)d&&(i=d.getRenderedRange(),l.forEach(function(e){var t=function(e,t){if(Math.abs(t.bottom-f-e)>2*w)return!0;return!1}(u.getRowById(e[p]),i);!t&&0<=h(m,e[p])?y(e,e[p]):t&&x(e,e[p])}));else if(d){var o=d.getRenderedRange();if(0<l.length){var a="DOWN";if(t){if(t.top===o.top&&t.bottom===o.bottom)return;(t.top>o.top||0===t.top&&0===o.top&&t.bottom>o.bottom)&&(a="UP")}}l.forEach(function(e){var t=u.getRowById(e[p]),i=e[g+"sizePadding"],n=0<=h(m,e[p]);"UP"===a?(R.saveDetailViewOnScroll&&t>=o.bottom-f&&P(e),n&&t-s<o.top&&t>=o.top?y(e,e[p]):!n&&t+i>o.bottom&&x(e,e[p])):"DOWN"===a&&(R.saveDetailViewOnScroll&&t<=o.top+f&&P(e),n&&t+i+s>o.bottom&&t<t+i?y(e,e[p]):!n&&t<o.top&&x(e,e[p]))}),t=o}}function x(e,t){var i=e.rowIndex||u.getRowById(e[p]);o.onRowOutOfViewportRange.notify({grid:d,item:e,rowId:t,rowIndex:i,expandedRows:l,rowIdsOutOfViewport:C(t,!0)},null,o)}function y(e,t){var i=e.rowIndex||u.getRowById(e[p]);setTimeout(function(){document.querySelector(`.${c} .cellDetailView_`+e[p])&&o.onRowBackToViewportRange.notify({grid:d,item:e,rowId:t,rowIndex:i,expandedRows:l,rowIdsOutOfViewport:C(t,!1)},null,o)},100)}function C(e,t){var i=h(m,e);return t&&i<0?m.push(e):!t&&0<=i&&m.splice(i,1),m}function D(){u.beginUpdate();for(var e=l.length-1;0<=e;e--)V(l[e],!0);u.endUpdate()}function V(t,e){e||u.beginUpdate(),R.loadOnce&&P(t),t[g+"collapsed"]=!0;for(var i=1;i<=t[g+"sizePadding"];i++)u.deleteItem(t[p]+"."+i);t[g+"sizePadding"]=0,u.updateItem(t[p],t),l=l.filter(function(e){return e[p]!==t[p]}),e||u.endUpdate()}function I(e){R&&R.singleRowExpand&&D(),e[g+"collapsed"]=!1,l.push(e),e[g+"detailContent"]||(e[g+"detailViewLoaded"]=!1),e[g+"detailViewLoaded"]&&!0===R.loadOnce?(o.onAsyncResponse.notify({item:e,itemDetail:e,detailView:e[g+"detailContent"]},void 0,this),S(e),u.updateItem(e[p],e)):(e[g+"detailContent"]=R.preTemplate(e),S(e),u.updateItem(e[p],e),R.process(e))}function P(e){var t=document.querySelector(`.${c} .innerDetailView_`+e[p]);t&&void 0!==(t=t.innerHTML)&&(e[g+"detailContent"]=t)}var O=function(e,t){var i,n={};for(i in d.getData())n[i]=null;return n[p]=e[p]+"."+t,n[g+"collapsed"]=!0,n[g+"isPadding"]=!0,n[g+"parent"]=e,n[g+"offset"]=t,n};function S(e){for(var t=R.panelRows,i=(e[g+"sizePadding"]=Math.ceil(2*t*13/r.rowHeight),e[g+"height"]=e[g+"sizePadding"]*r.rowHeight,u.getIdxById(e[p])),n=1;n<=e[g+"sizePadding"];n++)u.insertItem(i+n,O(e,n))}function k(e,t,i,n,o,a){var l,s;return!z(e,o,a)||(null==o[g+"collapsed"]&&(o[g+"collapsed"]=!0,o[g+"sizePadding"]=0,o[g+"height"]=0,o[g+"isPadding"]=!1,o[g+"parent"]=void 0,o[g+"offset"]=0),o[g+"isPadding"])?null:o[g+"collapsed"]?(e=R.cssClass+" expand ",R.collapsedClass&&(e+=R.collapsedClass),'<div class="'+e+'"></div>'):(a=[],e=r.rowHeight,l=o[g+"sizePadding"]*r.rowHeight,null!==R.maxRows&&o[g+"sizePadding"]>R.maxRows&&(l=R.maxRows*e,o[g+"sizePadding"]=R.maxRows),s=R.cssClass+" collapse ",R.expandedClass&&(s+=R.expandedClass),a.push('<div class="'+s+'"></div></div>'),a.push('<div class="dynamic-cell-detail cellDetailView_',o[p],'" '),a.push('style="height:',l,"px;"),a.push("top:",e,'px">'),a.push('<div class="detail-container detailViewContainer_',o[p],'">'),a.push('<div class="innerDetailView_',o[p],'">',o[g+"detailContent"],"</div></div>"),a.join(""))}function z(e,t,i){return"function"!=typeof n||n(e,t,i)}function E(e){n=e}Slick.Utils.extend(this,{init:function(e){if(!e)throw new Error('RowDetailView Plugin requires the Grid instance to be passed as argument to the "init()" method');c=(d=e).getUID(),r=e.getOptions()||{},u=d.getData(),g=R&&R.keyPrefix||"_",f=d.getOptions().minRowBuffer,d.getOptions().minRowBuffer=R.panelRows+3,i.subscribe(d.onClick,v).subscribe(d.onScroll,b),R.collapseAllOnSort&&(i.subscribe(d.onSort,D),l=[],m=[]),i.subscribe(d.getData().onRowCountChanged,function(){d.updateRowCount(),d.render()}),i.subscribe(d.getData().onRowsChanged,function(e,t){d.invalidateRows(t.rows),d.render()}),o.onAsyncResponse.subscribe(function(e,t){if(!t||!t.item&&!t.itemDetail)throw'Slick.RowDetailView plugin requires the onAsyncResponse() to supply "args.item" property.';var i=t.item||t.itemDetail;t.detailView?i[g+"detailContent"]=t.detailView:i[g+"detailContent"]=R.postTemplate(i),i[g+"detailViewLoaded"]=!0,u.updateItem(i[p],i),o.onAsyncEndUpdate.notify({grid:d,item:i,itemDetail:i},e,o)}),i.subscribe(u.onSetItemsCalled,function(){p=u&&u.getIdPropertyName()||"id"}),R.useSimpleViewportCalc&&i.subscribe(d.onRendered,function(e,t){t&&t.endRow&&(w=t.endRow-t.startRow)})},destroy:function(){i.unsubscribeAll(),o.onAsyncResponse.unsubscribe(),o.onAsyncEndUpdate.unsubscribe(),o.onAfterRowDetailToggle.unsubscribe(),o.onBeforeRowDetailToggle.unsubscribe(),o.onRowOutOfViewportRange.unsubscribe(),o.onRowBackToViewportRange.unsubscribe()},pluginName:"RowDetailView",collapseAll:D,collapseDetailView:V,expandDetailView:I,expandableOverride:E,getColumnDefinition:function(){return{id:R.columnId,name:"",toolTip:R.toolTip,field:"sel",width:R.width,resizable:!1,sortable:!1,alwaysRenderColumn:R.alwaysRenderColumn,cssClass:R.cssClass,formatter:k}},getExpandedRows:function(){return l},getFilterItem:function(e){return e=e[g+"isPadding"]&&e[g+"parent"]?e[g+"parent"]:e},getOptions:function(){return R},resizeDetailView:function(e){if(e){var t=document.querySelector("."+c+" .detailViewContainer_"+e[p]),i=document.querySelector("."+c+" .cellDetailView_"+e[p]),n=document.querySelector("."+c+" .innerDetailView_"+e[p]);if(t&&i&&n){for(var o=1;o<=e[g+"sizePadding"];o++)u.deleteItem(e[p]+"."+o);for(var n=r.rowHeight,a=(t.style.minHeight=null,t.scrollHeight),l=Math.ceil(a/n),l=(e[g+"sizePadding"]=Math.ceil(2*l*13/n),e[g+"height"]=a,e[g+"sizePadding"]*n),s=(null!==R.maxRows&&e[g+"sizePadding"]>R.maxRows&&(l=R.maxRows*n,e[g+"sizePadding"]=R.maxRows),d.getOptions().minRowBuffer<e[g+"sizePadding"]&&(d.getOptions().minRowBuffer=e[g+"sizePadding"]+3),t.setAttribute("style","min-height: "+e[g+"height"]+"px"),i&&i.setAttribute("style","height: "+l+"px; top:"+n+"px"),u.getIdxById(e[p])),o=1;o<=e[g+"sizePadding"];o++)u.insertItem(s+o,O(e,o));P(e)}}},saveDetailView:P,setOptions:function(e){(R=Slick.Utils.extend(!0,{},R,e))&&R.singleRowExpand&&D()},onAsyncResponse:new Slick.Event,onAsyncEndUpdate:new Slick.Event,onAfterRowDetailToggle:new Slick.Event,onBeforeRowDetailToggle:new Slick.Event,onRowOutOfViewportRange:new Slick.Event,onRowBackToViewportRange:new Slick.Event})}}}})}(window);