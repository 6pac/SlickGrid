/**
 * SlickGrid v4.0.1
 * (c) 2009-present Michael Leibman
 * homepage: http://github.com/mleibman/slickgrid
 * license: MIT
 * date: 2023-06-30
 * file: ./plugins/slick.cellexternalcopymanager.js
 */
!function(b){Slick.Utils.extend(!0,b,{Slick:{CellExternalCopyManager:function(e){var g,p,y=this,v=e||{},i=v.copiedCellStyleLayerKey||"copy-manager",r=v.copiedCellStyle||"copied",s=0,w=v.bodyElement||document.body,S=v.onCopyInit||null,D=v.onCopySuccess||null,E={C:67,V:86,ESC:27,INSERT:45};function R(e,t,l){var o,n;return t.denyPaste?null:v.dataItemColumnValueSetter?v.dataItemColumnValueSetter(e,t,l):void(t.editor?(o=document.createElement("div"),(n=new t.editor({container:o,column:t,position:{top:0,left:0},grid:g})).loadValue(e),n.applyValue(e,l),n.destroy(),o.remove()):e[t.field]=l)}function x(e){var t=document.createElement("textarea");return t.style.position="absolute",t.style.left="-1000px",t.style.top=document.body.scrollTop+"px",t.value=e,w.appendChild(t),t.select(),t}function t(e,t){var l;if(!g.getEditorLock().isActive()||g.getOptions().autoEdit){if(e.which==E.ESC&&p&&(e.preventDefault(),I(),y.onCopyCancelled.notify({ranges:p}),p=null),(e.which===E.C||e.which===E.INSERT)&&(e.ctrlKey||e.metaKey)&&!e.shiftKey&&(S&&S.call(),0!==(l=g.getSelectionModel().getSelectedRanges()).length)){V(p=l),y.onCopyCells.notify({ranges:l});for(var o,f,n,a=g.getColumns(),i="",r=0;r<l.length;r++){for(var s=l[r],c=[],d=s.fromRow;d<s.toRow+1;d++){var u=[],h=g.getDataItem(d);if(0===c.length&&v.includeHeaderWhenCopying){for(var m=[],C=s.fromCell;C<s.toCell+1;C++)0<a[C].name.length&&!a[C].hidden&&m.push(function(e){if(v.headerColumnValueExtractor){var t=v.headerColumnValueExtractor(e);if(t)return t}return e.name}(a[C]));c.push(m.join("\t"))}for(C=s.fromCell;C<s.toCell+1;C++)0<a[C].name.length&&!a[C].hidden&&u.push(function(e,t,l){if("function"==typeof v.dataItemColumnValueExtractor){var o=v.dataItemColumnValueExtractor(e,t);if(o)return o}let n="";return t&&t.editor?(o=document.createElement("p"),(l=new t.editor({container:o,column:t,event:l,position:{top:0,left:0},grid:g})).loadValue(e),n=l.serializeValue(),l.destroy(),o.remove()):n=e[t.field||""],n}(h,a[C],e));c.push(u.join("\t"))}i+=c.join("\r\n")+"\r\n"}return b.clipboardData?(b.clipboardData.setData("Text",i),!0):(o=document.activeElement,(f=x(i)).focus(),setTimeout(function(){w.removeChild(f),o?o.focus():console.log("Not element to restore focus to after copy?")},100),D&&(n=0,n=1===l.length?l[0].toRow+1-l[0].fromRow:l.length,D.call(this,n)),!1)}if(!v.readOnlyMode&&(e.which===E.V&&(e.ctrlKey||e.metaKey)&&!e.shiftKey||e.which===E.INSERT&&e.shiftKey&&!e.ctrlKey))return f=x(""),setTimeout(function(){var r=g,e=f,s=r.getColumns(),t=e.value.split(/[\n\f\r]/),i=(""===t[t.length-1]&&t.pop(),[]),l=0;w.removeChild(e);for(var o=0;o<t.length;o++)""!==t[o]?i[l++]=t[o].split("\t"):i[l++]=[""];var e=r.getActiveCell(),n=(n=r.getSelectionModel().getSelectedRanges())&&n.length?n[0]:null,c=null,d=null;if(n)c=n.fromRow,d=n.fromCell;else{if(!e)return;c=e.row,d=e.cell}var u=!1,a=i.length,e=i.length?i[0].length:0,h=(1==i.length&&1==i[0].length&&n&&(u=!0,a=n.toRow-n.fromRow+1,e=n.toCell-n.fromCell+1),r.getData().length-c),m=0;if(h<a&&v.newRowCreator){for(var C=r.getData(),m=1;m<=a-h;m++)C.push({});r.setData(C),r.render()}n=c+a>r.getDataLength(),v.newRowCreator&&n&&(n=c+a-r.getDataLength(),v.newRowCreator(n)),n={isClipboardCommand:!0,clippedRange:i,oldValues:[],cellExternalCopyManager:y,_options:v,setDataItemValueForColumn:R,markCopySelection:V,oneCellToMultiple:u,activeRow:c,activeCell:d,destH:a,destW:e,maxDestY:r.getDataLength(),maxDestX:r.getColumns().length,h:0,w:0,execute:function(){for(var e=this.h=0;e<this.destH;e++){this.oldValues[e]=[],this.w=0,this.h++;for(var t=0;t<this.destW;t++){this.w++;var l,o=c+e,n=d+t;o<this.maxDestY&&n<this.maxDestX&&(r.getCellNode(o,n),l=r.getDataItem(o),this.oldValues[e][t]=l[s[n].field],u?this.setDataItemValueForColumn(l,s[n],i[0][0]):this.setDataItemValueForColumn(l,s[n],i[e]?i[e][t]:""),r.updateCell(o,n),r.onCellChange.notify({row:o,cell:n,item:l,grid:r}))}}var a={fromCell:d,fromRow:c,toCell:d+this.w-1,toRow:c+this.h-1};this.markCopySelection([a]),r.getSelectionModel().setSelectedRanges([a]),this.cellExternalCopyManager.onPasteCells.notify({ranges:[a]})},undo:function(){for(var e=0;e<this.destH;e++)for(var t=0;t<this.destW;t++){var l,o=c+e,n=d+t;o<this.maxDestY&&n<this.maxDestX&&(r.getCellNode(o,n),l=r.getDataItem(o),u?this.setDataItemValueForColumn(l,s[n],this.oldValues[0][0]):this.setDataItemValueForColumn(l,s[n],this.oldValues[e][t]),r.updateCell(o,n),r.onCellChange.notify({row:o,cell:n,item:l,grid:r}))}var a={fromCell:d,fromRow:c,toCell:d+this.w-1,toRow:c+this.h-1};if(this.markCopySelection([a]),r.getSelectionModel().setSelectedRanges([a]),this.cellExternalCopyManager.onPasteCells.notify({ranges:[a]}),1<m){for(var i=r.getData();1<m;m--)i.splice(i.length-1,1);r.setData(i),r.render()}}},v.clipboardCommandHandler?v.clipboardCommandHandler(n):n.execute()},100),!1}}function V(e){I();for(var t=g.getColumns(),l={},o=0;o<e.length;o++)for(var n=e[o].fromRow;n<=e[o].toRow;n++){l[n]={};for(var a=e[o].fromCell;a<=e[o].toCell&&a<t.length;a++)l[n][t[a].id]=r}g.setCellCssStyles(i,l),clearTimeout(s),s=setTimeout(function(){y.clearCopySelection()},2e3)}function I(){g.removeCellCssStyles(i)}Slick.Utils.extend(this,{init:function(e){if((g=e).onKeyDown.subscribe(t),!(e=e.getSelectionModel()))throw new Error("Selection model is mandatory for this plugin. Please set a selection model on the grid before adding this plugin: grid.setSelectionModel(new Slick.CellSelectionModel())");e.onSelectedRangesChanged.subscribe(()=>{g.getEditorLock().isActive()||g.focus()})},destroy:function(){g.onKeyDown.unsubscribe(t)},pluginName:"CellExternalCopyManager",clearCopySelection:I,handleKeyDown:t,onCopyCells:new Slick.Event,onCopyCancelled:new Slick.Event,onPasteCells:new Slick.Event,setIncludeHeaderWhenCopying:function(e){v.includeHeaderWhenCopying=e}})}}})}(window);