/**
 * SlickGrid v4.0.1
 * (c) 2009-present Michael Leibman
 * homepage: http://github.com/mleibman/slickgrid
 * license: MIT
 * date: 2023-06-30
 * file: ./plugins/slick.draggablegrouping.js
 */
!function(e){Slick.Utils.extend(!0,e,{Slick:{DraggableGrouping:function(d){var t,p,u,n,s,a,y,h,v,k,i={},o=new Slick.Event,g=new Slick.BindingEventService,c=new Slick.EventHandler;var m=[];function f(e,l){var o,r,t,n=l.getAttribute("data-id"),s=n&&n.replace(p,"");let a=!0;for(const i of m)i.id===s&&(a=!1);if(a){for(const c of u)c.id===s&&c.grouping&&!Slick.Utils.isEmptyObject(c.grouping)&&(r=l.querySelector(".slick-column-name"),(o=document.createElement("div")).id=`${p}_${c.id}_entry`,o.className="slick-dropped-grouping",o.dataset.id=""+c.id,(t=document.createElement("div")).className="slick-dropped-grouping-title",t.style.display="inline-flex",t.textContent=(r||l).textContent,o.appendChild(t),(r=document.createElement("div")).className="slick-groupby-remove",d.deleteIconCssClass&&r.classList.add(...d.deleteIconCssClass.split(" ")),d.deleteIconImage&&r.classList.add(...d.deleteIconImage.split(" ")),d.deleteIconCssClass||r.classList.add("slick-groupby-remove-icon"),d.deleteIconImage||r.classList.add("slick-groupby-remove-image"),d&&!0!==d.hideGroupSortIcons&&c.sortable&&c.grouping&&void 0===c.grouping.sortAsc&&(c.grouping.sortAsc=!0),o.appendChild(r),o.appendChild(document.createElement("div")),e.appendChild(o),t=c,m.push(t),b("add-group"),function(r,t,n){g.bind(t,"click",()=>{for(const o of g.boundedEvents.filter(e=>e.element===t))g.unbind(o.element,"click",o.listener);var e=r,l=(n.remove(),[]);u.forEach(function(e){l[e.id]=e}),function(e){var l,o,r=arguments,t=r.length;for(;1<t&&e.length;)for(l=r[--t];-1!=(o=e.indexOf(l));)e.splice(o,1)}(m,l[e]),0===m.length&&(y.style="block",h.style.display="none"),b("remove-group")})}(c.id,r,o));h.style.display="inline-block"}}function b(e){var l;0===m.length?(n.setGrouping([]),o.notify({caller:e,groupColumns:[]})):(l=[],m.forEach(function(e){l.push(e.grouping)}),n.setGrouping(l),o.notify({caller:e,groupColumns:l}))}Slick.Utils.extend(this,{init:function(e){d=Slick.Utils.extend(!0,{},i,d),p=(t=e).getUID(),u=t.getColumns(),n=t.getData(),(s=e.getPreHeaderPanel()).classList.add("slick-dropzone"),e=d.dropPlaceHolderText||"Drop a column header here to group by the column",(y=document.createElement("div")).className="slick-placeholder",y.textContent=e,(h=document.createElement("div")).className="slick-group-toggle-all expanded",h.style.display="none",s.appendChild(y),s.appendChild(h);{const r=s;a=Sortable.create(r,{group:"shared",ghostClass:"slick-droppable-sortitem-hover",draggable:".slick-dropped-grouping",dragoverBubble:!0,onAdd:e=>{var l=e.item,o=l.getAttribute("id");o&&o.replace(p,"")&&f(r,Sortable.utils.clone(e.item)),e.clone.style.opacity=".5",l.parentNode&&l.parentNode.removeChild(l)},onUpdate:()=>{for(var e=a&&a.toArray()||[],l=[],o=0,r=e.length;o<r;o++)for(var t=0,n=m.length;t<n;t++)if(m[t].id==e[o]){l.push(m[t]);break}m=l,b("sort-group")}});e=s.querySelector(".slick-placeholder");e&&(g.bind(e,"dragover",e=>e.preventDefault),g.bind(e,"dragenter",()=>s.classList.add("slick-dropzone-hover")),g.bind(e,"dragleave",()=>s.classList.remove("slick-dropzone-hover"))),h&&g.bind(h,"click",e=>{var l,o,e=e.target;[e,l=!0,o=!0]=[e,e&&e.classList.contains("expanded")],e&&(!0===l?(e.classList.add("collapsed"),e.classList.remove("expanded"),o&&n.collapseAllGroups()):(e.classList.remove("collapsed"),e.classList.add("expanded"),o&&n.expandAllGroups()))})}c.subscribe(t.onHeaderCellRendered,function(e,l){var o=l.column,l=l.node;!Slick.Utils.isEmptyObject(o.grouping)&&l&&(l.style.cursor="pointer",d.groupIconCssClass||d.groupIconImage)&&((o=document.createElement("span")).className="slick-column-groupable",d.groupIconCssClass&&o.classList.add(...d.groupIconCssClass.split(" ")),d.groupIconImage&&(o.style.background="url("+d.groupIconImage+") no-repeat center center"),l.appendChild(o))});for(var l=0;l<u.length;l++){var o=u[l].field;t.updateColumnHeader(o)}},destroy:function(){v&&v.el&&v.destroy(),k&&k.el&&k.destroy(),o.unsubscribe(),c.unsubscribeAll(),g.unbindAll(),Slick.Utils.emptyElement(document.querySelector(`.${p} .slick-preheader-panel`))},pluginName:"DraggableGrouping",onGroupChanged:o,setDroppedGroups:function(e){e=Array.isArray(e)?e:[e],y.style.display="none";for(const o of e){var l=t.getHeaderColumn(o);f(s,l)}},clearDroppedGroups:function(){m=[],b("clear-all");var e=s.querySelectorAll(".slick-dropped-grouping");h.style.display="none";for(const o of Array.from(e)){var l=s.querySelector(".slick-groupby-remove");l&&l.remove(),o&&o.remove()}y.style.display="inline-block"},getSetupColumnReorder:function(i,c,e,d,p,l,u,o,g){const m=i.getPreHeaderPanel();var r={animation:50,ghostClass:"slick-sortable-placeholder",draggable:".slick-header-column",dataIdAttr:"data-id",group:{name:"shared",pull:"clone",put:!1},revertClone:!0,onStart:function(){m.classList.add("slick-dropzone-hover"),m.classList.add("slick-dropzone-placeholder-hover"),m.querySelector(".slick-placeholder").style.display="inline-block",h.style.display="none",m.querySelectorAll(".slick-dropped-grouping").forEach(e=>e.style.display="none")},onEnd:function(e){var l=m.querySelector(".slick-placeholder"),o=(m.classList.remove("slick-dropzone-hover"),l.classList.remove("slick-dropzone-placeholder-hover"),y&&(y.style.display="none"),l&&l.parentElement&&l.parentElement.classList.remove("slick-dropzone-placeholder-hover"),m.querySelectorAll(".slick-dropped-grouping"));if(o.forEach(e=>e.style.display="inline-block"),o.length&&(l&&(l.style.display="none"),h.style.display="inline-block"),i.getEditorLock().commitCurrentEdit()){var r=v&&v.toArray()||[];if(1<c.length)for(const s of k&&k.toArray()||[])r.push(s);var t=[],n=i.getColumns();for(const a of r)t.push(n[u(a)]);d(t),g(i.onColumnsReordered,{grid:i}),e.stopPropagation(),p()}}};return v=Sortable.create(document.querySelector(`.${i.getUID()} .slick-header-columns.slick-header-columns-left`),r),k=Sortable.create(document.querySelector(`.${i.getUID()} .slick-header-columns.slick-header-columns-right`),r),{sortableLeftInstance:v,sortableRightInstance:k}}})}}})}(window);