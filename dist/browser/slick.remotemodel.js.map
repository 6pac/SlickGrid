{
  "version": 3,
  "sources": ["../../src/slick.remotemodel.ts"],
  "sourcesContent": ["import type { ColumnSort } from './models/index.js';\r\n\r\n/***\r\n * A sample AJAX data store implementation.\r\n * Right now, it's hooked up to load search results from Octopart, but can\r\n * easily be extended to support any JSONP-compatible backend that accepts paging parameters.\r\n */\r\nexport class SlickRemoteModel {\r\n  // private\r\n  protected PAGESIZE = 50;\r\n  protected data: any = { length: 0 };\r\n  protected searchstr = '';\r\n  protected sortcol: ColumnSort | null = null;\r\n  protected sortdir = 1;\r\n  protected h_request?: number;\r\n  protected req: any = null; // ajax request\r\n\r\n  // events\r\n  onDataLoading = new Slick.Event('onDataLoading');\r\n  onDataLoaded = new Slick.Event('onDataLoaded');\r\n\r\n  constructor() {\r\n    if (!(window.$ || window.jQuery) || !window.$.jsonp) {\r\n      throw new Error('SlickRemoteModel requires both jQuery and jQuery jsonp library to be loaded.');\r\n    }\r\n    this.init();\r\n  }\r\n\r\n  init() { }\r\n\r\n  isDataLoaded(from: number, to: number) {\r\n    for (let i = from; i <= to; i++) {\r\n      if (this.data[i] === undefined || this.data[i] === null) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clear() {\r\n    for (const key in this.data) {\r\n      delete this.data[key];\r\n    }\r\n    this.data.length = 0;\r\n  }\r\n\r\n  ensureData(from: number, to: number) {\r\n    if (this.req) {\r\n      this.req.abort();\r\n      for (let i = this.req.fromPage; i <= this.req.toPage; i++) {\r\n        this.data[i * this.PAGESIZE] = undefined;\r\n      }\r\n    }\r\n\r\n    if (from < 0) {\r\n      from = 0;\r\n    }\r\n\r\n    if (this.data.length > 0) {\r\n      to = Math.min(to, this.data.length - 1);\r\n    }\r\n\r\n    let fromPage = Math.floor(from / this.PAGESIZE);\r\n    let toPage = Math.floor(to / this.PAGESIZE);\r\n\r\n    while (this.data[fromPage * this.PAGESIZE] !== undefined && fromPage < toPage) {\r\n      fromPage++;\r\n    }\r\n\r\n    while (this.data[toPage * this.PAGESIZE] !== undefined && fromPage < toPage) {\r\n      toPage--;\r\n    }\r\n\r\n    if (fromPage > toPage || ((fromPage === toPage) && this.data[fromPage * this.PAGESIZE] !== undefined)) {\r\n      // TODO:  look-ahead\r\n      this.onDataLoaded.notify({ from, to });\r\n      return;\r\n    }\r\n\r\n    let url = 'http://octopart.com/api/v3/parts/search?apikey=[MY_API_KEY]&include[]=short_description&show[]=uid&show[]=manufacturer&show[]=mpn&show[]=brand&show[]=octopart_url&show[]=short_description&q=' + this.searchstr + '&start=' + (fromPage * this.PAGESIZE) + '&limit=' + (((toPage - fromPage) * this.PAGESIZE) + this.PAGESIZE);\r\n\r\n    if (this.sortcol !== null) {\r\n      url += ('&sortby=' + this.sortcol + ((this.sortdir > 0) ? '+asc' : '+desc'));\r\n    }\r\n\r\n    if (this.h_request) {\r\n      window.clearTimeout(this.h_request);\r\n    }\r\n\r\n    this.h_request = window.setTimeout(() => {\r\n      for (let i = fromPage; i <= toPage; i++) {\r\n        this.data[i * this.PAGESIZE] = null; // null indicates a 'requested but not available yet'\r\n      }\r\n      this.onDataLoading.notify({ from, to });\r\n\r\n      this.req = window.$.jsonp({\r\n        url,\r\n        callbackParameter: 'callback',\r\n        cache: true,\r\n        success: this.onSuccess,\r\n        error: () => this.onError(fromPage, toPage)\r\n      });\r\n      this.req.fromPage = fromPage;\r\n      this.req.toPage = toPage;\r\n    }, 50);\r\n  }\r\n\r\n  protected onError(fromPage: number | string, toPage: number | string) {\r\n    alert('error loading pages ' + fromPage + ' to ' + toPage);\r\n  }\r\n\r\n  protected onSuccess(resp: any) {\r\n    const from = resp.request.start, to = from + resp.results.length;\r\n    this.data.length = Math.min(parseInt(resp.hits), 1000); // limitation of the API\r\n\r\n    for (let i = 0; i < resp.results.length; i++) {\r\n      const item = resp.results[i].item;\r\n      this.data[from + i] = item;\r\n      this.data[from + i].index = from + i;\r\n    }\r\n\r\n    this.req = null;\r\n    this.onDataLoaded.notify({ from, to });\r\n  }\r\n\r\n  reloadData(from: number, to: number) {\r\n    for (let i = from; i <= to; i++) {\r\n      delete this.data[i];\r\n    }\r\n    this.ensureData(from, to);\r\n  }\r\n\r\n\r\n  setSort(column: ColumnSort, dir: number) {\r\n    this.sortcol = column;\r\n    this.sortdir = dir;\r\n    this.clear();\r\n  }\r\n\r\n  setSearch(str: string) {\r\n    this.searchstr = str;\r\n    this.clear();\r\n  }\r\n}\r\n\r\n// extend Slick namespace on window object when building as iife\r\nif (IIFE_ONLY && window.Slick) {\r\n  window.Slick.Data = window.Slick.Data || {};\r\n  window.Slick.Data.RemoteModel = SlickRemoteModel;\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
