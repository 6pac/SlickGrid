{
  "version": 3,
  "sources": ["../../src/slick.remotemodel-yahoo.ts"],
  "sourcesContent": ["/***\r\n * A sample AJAX data store implementation.\r\n * Right now, it's hooked up to load Hackernews stories, but can\r\n * easily be extended to support any JSONP-compatible backend that accepts paging parameters.\r\n */\r\nexport class SlickRemoteModelYahoo {\r\n  // protected\r\n  protected PAGESIZE = 10;\r\n  protected data: any = { length: 0 };\r\n  protected h_request?: number;\r\n  protected req: any = null; // ajax request\r\n\r\n  // events\r\n  protected onDataLoading = new Slick.Event('onDataLoading');\r\n  protected onDataLoaded = new Slick.Event('onDataLoaded');\r\n\r\n  constructor() {\r\n    if (!(window.$ || window.jQuery) || !window.$.jsonp) {\r\n      throw new Error('SlickRemoteModel requires both jQuery and jQuery jsonp library to be loaded.');\r\n    }\r\n    this.init();\r\n  }\r\n\r\n  init() { }\r\n\r\n  isDataLoaded(from: number, to: number) {\r\n    for (let i = from; i <= to; i++) {\r\n      if (this.data[i] === undefined || this.data[i] === null) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clear() {\r\n    for (const key in this.data) {\r\n      delete this.data[key];\r\n    }\r\n    this.data.length = 0;\r\n  }\r\n\r\n  ensureData(from: number, to: number) {\r\n    if (this.req) {\r\n      this.req.abort();\r\n      for (let i = this.req.fromPage; i <= this.req.toPage; i++) {\r\n        this.data[i * this.PAGESIZE] = undefined;\r\n      }\r\n    }\r\n\r\n    if (from < 0) {\r\n      from = 0;\r\n    }\r\n\r\n    if (this.data.length > 0) {\r\n      to = Math.min(to, this.data.length - 1);\r\n    }\r\n\r\n    let fromPage = Math.floor(from / this.PAGESIZE);\r\n    let toPage = Math.floor(to / this.PAGESIZE);\r\n\r\n    while (this.data[fromPage * this.PAGESIZE] !== undefined && fromPage < toPage) {\r\n      fromPage++;\r\n    }\r\n    while (this.data[toPage * this.PAGESIZE] !== undefined && fromPage < toPage) {\r\n      toPage--;\r\n    }\r\n    if (fromPage > toPage || ((fromPage === toPage) && this.data[fromPage * this.PAGESIZE] !== undefined)) {\r\n      // TODO:  look-ahead\r\n      this.onDataLoaded.notify({ from, to });\r\n      return;\r\n    }\r\n\r\n    const recStart = (fromPage * this.PAGESIZE);\r\n    const recCount = (((toPage - fromPage) * this.PAGESIZE) + this.PAGESIZE);\r\n\r\n    const url = 'https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20rss'\r\n      + '(' + recStart + '%2C' + recCount + ')'\r\n      + '%20where%20url%3D%22http%3A%2F%2Frss.news.yahoo.com%2Frss%2Ftopstories%22'\r\n      + '&format=json';\r\n\r\n    if (this.h_request) {\r\n      window.clearTimeout(this.h_request);\r\n    }\r\n\r\n    this.h_request = window.setTimeout(() => {\r\n      for (let i = fromPage; i <= toPage; i++) {\r\n        this.data[i * this.PAGESIZE] = null; // null indicates a 'requested but not available yet'\r\n      }\r\n      this.onDataLoading.notify({ from, to });\r\n\r\n      this.req = window.$.jsonp({\r\n        url,\r\n        callbackParameter: 'callback',\r\n        cache: true,\r\n        success: (json: any) => {\r\n          this.onSuccess(json, recStart);\r\n        },\r\n        error: () => {\r\n          this.onError(fromPage, toPage);\r\n        }\r\n      });\r\n\r\n      this.req.fromPage = fromPage;\r\n      this.req.toPage = toPage;\r\n    }, 50);\r\n  }\r\n\r\n\r\n  onError(fromPage: number, toPage: number) {\r\n    alert('error loading pages ' + fromPage + ' to ' + toPage);\r\n  }\r\n\r\n  // SAMPLE DATA\r\n  //    {\r\n  //      \"query\": {\r\n  //        \"count\": 40,\r\n  //        \"created\": \"2015-03-03T00:34:00Z\",\r\n  //        \"lang\": \"en-US\",\r\n  //        \"results\": {\r\n  //          \"item\": [\r\n  //            {\r\n  //              \"title\": \"Netanyahu assails Iran deal, touts US-Israel ties\",\r\n  //              \"description\": \"<p><a href=\\\"http://news.yahoo.com/netanyahu-us-officials-face-off-iran-133539021--politics.html\\\"><img src=\\\"http://l2.yimg.com/bt/api/res/1.2/4eoBxbJStrbGAKbmBYOJfg--/YXBwaWQ9eW5ld3M7Zmk9ZmlsbDtoPTg2O3E9NzU7dz0xMzA-/http://media.zenfs.com/en_us/News/ap_webfeeds/2f3a20c2d46d9f096f0f6a706700d430.jpg\\\" width=\\\"130\\\" height=\\\"86\\\" alt=\\\"Israeli Prime Minister Benjamin Netanyahu addresses the 2015 American Israel Public Affairs Committee (AIPAC) Policy Conference in Washington, Monday, March 2, 2015. (AP Photo/Cliff Owen)\\\" align=\\\"left\\\" title=\\\"Israeli Prime Minister Benjamin Netanyahu addresses the 2015 American Israel Public Affairs Committee (AIPAC) Policy Conference in Washington, Monday, March 2, 2015. (AP Photo/Cliff Owen)\\\" border=\\\"0\\\" /></a>WASHINGTON (AP) \u2014 Seeking to lower tensions, Benjamin Netanyahu and U.S. officials cast their dispute over Iran as a family squabble on Monday, even as the Israeli leader claimed President Barack Obama did not \u2014 and could not \u2014 fully understand his nation&#039;s vital security concerns.</p><br clear=\\\"all\\\"/>\",\r\n  //              \"link\": \"http://news.yahoo.com/netanyahu-us-officials-face-off-iran-133539021--politics.html\",\r\n  //              \"pubDate\": \"Mon, 02 Mar 2015 19:17:36 -0500\",\r\n  //              \"source\": {\r\n  //                \"url\": \"http://www.ap.org/\",\r\n  //                \"content\": \"Associated Press\"\r\n  //              },\r\n  //              \"guid\": {\r\n  //                \"isPermaLink\": \"false\",\r\n  //                \"content\": \"netanyahu-us-officials-face-off-iran-133539021--politics\"\r\n  //              },\r\n  //              \"content\": {\r\n  //                \"height\": \"86\",\r\n  //                \"type\": \"image/jpeg\",\r\n  //                \"url\": \"http://l2.yimg.com/bt/api/res/1.2/4eoBxbJStrbGAKbmBYOJfg--/YXBwaWQ9eW5ld3M7Zmk9ZmlsbDtoPTg2O3E9NzU7dz0xMzA-/http://media.zenfs.com/en_us/News/ap_webfeeds/2f3a20c2d46d9f096f0f6a706700d430.jpg\",\r\n  //                \"width\": \"130\"\r\n  //              },\r\n  //              \"text\": {\r\n  //                \"type\": \"html\",\r\n  //                \"content\": \"<p><a href=\\\"http://news.yahoo.com/netanyahu-us-officials-face-off-iran-133539021--politics.html\\\"><img src=\\\"http://l2.yimg.com/bt/api/res/1.2/4eoBxbJStrbGAKbmBYOJfg--/YXBwaWQ9eW5ld3M7Zmk9ZmlsbDtoPTg2O3E9NzU7dz0xMzA-/http://media.zenfs.com/en_us/News/ap_webfeeds/2f3a20c2d46d9f096f0f6a706700d430.jpg\\\" width=\\\"130\\\" height=\\\"86\\\" alt=\\\"Israeli Prime Minister Benjamin Netanyahu addresses the 2015 American Israel Public Affairs Committee (AIPAC) Policy Conference in Washington, Monday, March 2, 2015. (AP Photo/Cliff Owen)\\\" align=\\\"left\\\" title=\\\"Israeli Prime Minister Benjamin Netanyahu addresses the 2015 American Israel Public Affairs Committee (AIPAC) Policy Conference in Washington, Monday, March 2, 2015. (AP Photo/Cliff Owen)\\\" border=\\\"0\\\" /></a>WASHINGTON (AP) \u2014 Seeking to lower tensions, Benjamin Netanyahu and U.S. officials cast their dispute over Iran as a family squabble on Monday, even as the Israeli leader claimed President Barack Obama did not \u2014 and could not \u2014 fully understand his nation&#039;s vital security concerns.</p><br clear=\\\"all\\\"/>\"\r\n  //              },\r\n  //              \"credit\": {\r\n  //                \"role\": \"publishing company\"\r\n  //              }\r\n  //            },\r\n  //            {... },\r\n  //            {... },\r\n  //          ]\r\n  //        }\r\n  //      }\r\n  //    }\r\n\r\n  onSuccess(json: any, recStart: number) {\r\n    let recEnd = recStart;\r\n    if (json.query.count > 0) {\r\n      const results = json.query.results.item;\r\n      recEnd = recStart + results.length;\r\n      this.data.length = 100;// Math.min(parseInt(results.length),1000); // limitation of the API\r\n\r\n      for (let i = 0; i < results.length; i++) {\r\n        const item = results[i];\r\n\r\n        item.pubDate = new Date(item.pubDate);\r\n\r\n        this.data[recStart + i] = { index: recStart + i };\r\n        this.data[recStart + i].pubDate = item.pubDate;\r\n        this.data[recStart + i].title = item.title;\r\n        this.data[recStart + i].url = item.link;\r\n        this.data[recStart + i].text = item.description;\r\n      }\r\n    }\r\n    this.req = null;\r\n\r\n    this.onDataLoaded.notify({ from: recStart, to: recEnd });\r\n  }\r\n\r\n\r\n  reloadData(from: number, to: number) {\r\n    for (let i = from; i <= to; i++) {\r\n      delete this.data[i];\r\n    }\r\n    this.ensureData(from, to);\r\n  }\r\n\r\n\r\n  // return {\r\n  //   // properties\r\n  //   \"data\": data,\r\n\r\n  //   // methods\r\n  //   \"clear\": clear,\r\n  //   \"isDataLoaded\": isDataLoaded,\r\n  //   \"ensureData\": ensureData,\r\n  //   \"reloadData\": reloadData,\r\n\r\n  //   // events\r\n  //   \"onDataLoading\": onDataLoading,\r\n  //   \"onDataLoaded\": onDataLoaded\r\n  // };\r\n}\r\n\r\n// extend Slick namespace on window object when building as iife\r\nif (IIFE_ONLY && window.Slick) {\r\n  window.Slick.Data = window.Slick.Data || {};\r\n  window.Slick.Data.RemoteModelYahoo = SlickRemoteModelYahoo;\r\n}"],
  "mappings": "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",
  "names": []
}
