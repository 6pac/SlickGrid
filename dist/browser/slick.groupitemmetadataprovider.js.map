{
  "version": 3,
  "sources": ["../../src/slick.groupitemmetadataprovider.ts"],
  "sourcesContent": ["import { SlickGroup as SlickGroup_, keyCode as keyCode_, Utils as Utils_ } from './slick.core';\nimport type { Column, DOMEvent, GroupItemMetadataProviderOption, GroupingFormatterItem, ItemMetadata } from './models/index';\nimport type { SlickGrid } from './slick.grid';\n\n// for (iife) load Slick methods from global Slick object, or use imports for (esm)\nconst keyCode = IIFE_ONLY ? Slick.keyCode : keyCode_;\nconst SlickGroup = IIFE_ONLY ? Slick.Group : SlickGroup_;\nconst Utils = IIFE_ONLY ? Slick.Utils : Utils_;\n\n/**\n * Provides item metadata for group (Slick.Group) and totals (Slick.Totals) rows produced by the DataView.\n * This metadata overrides the default behavior and formatting of those rows so that they appear and function\n * correctly when processed by the grid.\n *\n * This class also acts as a grid plugin providing event handlers to expand & collapse groups.\n * If \"grid.registerPlugin(...)\" is not called, expand & collapse will not work.\n *\n * @class GroupItemMetadataProvider\n * @module Data\n * @namespace Slick.Data\n * @constructor\n * @param inputOptions\n */\nexport class SlickGroupItemMetadataProvider {\n  protected _grid!: SlickGrid;\n  protected _options: GroupItemMetadataProviderOption;\n  protected _defaults: GroupItemMetadataProviderOption = {\n    checkboxSelect: false,\n    checkboxSelectCssClass: 'slick-group-select-checkbox',\n    checkboxSelectPlugin: null,\n    groupCssClass: 'slick-group',\n    groupTitleCssClass: 'slick-group-title',\n    totalsCssClass: 'slick-group-totals',\n    groupFocusable: true,\n    totalsFocusable: false,\n    toggleCssClass: 'slick-group-toggle',\n    toggleExpandedCssClass: 'expanded',\n    toggleCollapsedCssClass: 'collapsed',\n    enableExpandCollapse: true,\n    groupFormatter: this.defaultGroupCellFormatter.bind(this),\n    totalsFormatter: this.defaultTotalsCellFormatter.bind(this),\n    includeHeaderTotals: false\n  };\n\n  constructor(inputOptions?: GroupItemMetadataProviderOption) {\n    this._options = Utils.extend<GroupItemMetadataProviderOption>(true, {}, this._defaults, inputOptions);\n  }\n\n  /** Getter of SlickGrid DataView object */\n  protected get dataView(): any {\n    return this._grid?.getData?.() ?? {} as any;\n  }\n\n  getOptions() {\n    return this._options;\n  }\n\n  setOptions(inputOptions: GroupItemMetadataProviderOption) {\n    Utils.extend(true, this._options, inputOptions);\n  }\n\n  protected defaultGroupCellFormatter(_row: number, _cell: number, _value: any, _columnDef: Column, item: any) {\n    if (!this._options.enableExpandCollapse) {\n      return item.title;\n    }\n\n    const indentation = `${item.level * 15}px`;\n    const toggleClass = item.collapsed ? this._options.toggleCollapsedCssClass : this._options.toggleExpandedCssClass;\n\n    // use a DocumentFragment to avoid creating an extra div container\n    const containerElm = document.createDocumentFragment();\n\n    // 1. optional row checkbox span to select the entire group rows\n    if (this._options.checkboxSelect) {\n      containerElm.appendChild(Utils.createDomElement('span', { className: `${this._options.checkboxSelectCssClass} ${item.selectChecked ? 'checked' : 'unchecked'}` }));\n    }\n\n    // 2. group toggle span\n    containerElm.appendChild(Utils.createDomElement('span', {\n      className: `${this._options.toggleCssClass} ${toggleClass}`,\n      ariaExpanded: String(!item.collapsed),\n      style: { marginLeft: indentation }\n    }));\n\n    // 3. group title span\n    const groupTitleElm = Utils.createDomElement('span', { className: this._options.groupTitleCssClass || '' });\n    groupTitleElm.setAttribute('level', item.level);\n    (item.title instanceof HTMLElement)\n      ? groupTitleElm.appendChild(item.title)\n      : this._grid.applyHtmlCode(groupTitleElm, item.title ?? '');\n    containerElm.appendChild(groupTitleElm);\n\n    return containerElm;\n  }\n\n  protected defaultTotalsCellFormatter(_row: number, _cell: number, _value: any, columnDef: Column, item: any, grid: SlickGrid) {\n    return (columnDef?.groupTotalsFormatter?.(item, columnDef, grid)) ?? '';\n  }\n\n\n  init(grid: SlickGrid) {\n    this._grid = grid;\n    this._grid.onClick.subscribe(this.handleGridClick.bind(this));\n    this._grid.onKeyDown.subscribe(this.handleGridKeyDown.bind(this));\n  }\n\n  destroy() {\n    if (this._grid) {\n      this._grid.onClick.unsubscribe(this.handleGridClick.bind(this));\n      this._grid.onKeyDown.unsubscribe(this.handleGridKeyDown.bind(this));\n    }\n  }\n\n  protected handleGridClick(e: DOMEvent<HTMLDivElement>, args: { row: number; cell: number; grid: SlickGrid; }) {\n    const target = e.target;\n    const item = this._grid.getDataItem(args.row);\n    if (item && item instanceof SlickGroup && target.classList.contains(this._options.toggleCssClass || '')) {\n      this.handleDataViewExpandOrCollapse(item);\n      e.stopImmediatePropagation();\n      e.preventDefault();\n    }\n    if (item && item instanceof SlickGroup && target.classList.contains(this._options.checkboxSelectCssClass || '')) {\n      item.selectChecked = !item.selectChecked;\n      target.classList.remove((item.selectChecked ? 'unchecked' : 'checked'));\n      target.classList.add((item.selectChecked ? 'checked' : 'unchecked'));\n      // get rowIndexes array\n      const rowIndexes = this.dataView.mapItemsToRows(item.rows);\n      (item.selectChecked ? this._options.checkboxSelectPlugin.selectRows : this._options.checkboxSelectPlugin.deSelectRows)(rowIndexes);\n    }\n  }\n\n  // TODO:  add -/+ handling\n  protected handleGridKeyDown(e: KeyboardEvent) {\n    if (this._options.enableExpandCollapse && (e.which === keyCode.SPACE)) {\n      const activeCell = this._grid.getActiveCell();\n      if (activeCell) {\n        const item = this._grid.getDataItem(activeCell.row);\n        if (item && item instanceof SlickGroup) {\n          this.handleDataViewExpandOrCollapse(item);\n          e.stopImmediatePropagation();\n          e.preventDefault();\n        }\n      }\n    }\n  }\n\n  protected handleDataViewExpandOrCollapse(item: any) {\n    const range = this._grid.getRenderedRange();\n    this.dataView.setRefreshHints({\n      ignoreDiffsBefore: range.top,\n      ignoreDiffsAfter: range.bottom + 1\n    });\n\n    if (item.collapsed) {\n      this.dataView.expandGroup(item.groupingKey);\n    } else {\n      this.dataView.collapseGroup(item.groupingKey);\n    }\n  }\n\n  getGroupRowMetadata(item: GroupingFormatterItem): ItemMetadata {\n    const groupLevel = item?.level;\n    return {\n      selectable: false,\n      focusable: this._options.groupFocusable,\n      cssClasses: `${this._options.groupCssClass} slick-group-level-${groupLevel}`,\n      formatter: (this._options.includeHeaderTotals && this._options.totalsFormatter) || undefined,\n      columns: {\n        0: {\n          colspan: this._options.includeHeaderTotals ? '1' : '*',\n          formatter: this._options.groupFormatter,\n          editor: null\n        }\n      }\n    };\n  }\n\n  getTotalsRowMetadata(item: { group: GroupingFormatterItem }): ItemMetadata | null {\n    const groupLevel = item?.group?.level;\n    return {\n      selectable: false,\n      focusable: this._options.totalsFocusable,\n      cssClasses: `${this._options.totalsCssClass} slick-group-level-${groupLevel}`,\n      formatter: this._options.totalsFormatter,\n      editor: null\n    };\n  }\n}\n\n// extend Slick namespace on window object when building as iife\nif (IIFE_ONLY && window.Slick) {\n  window.Slick.Data = window.Slick.Data || {};\n  window.Slick.Data.GroupItemMetadataProvider = SlickGroupItemMetadataProvider;\n}\n"],
  "mappings": "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",
  "names": []
}
